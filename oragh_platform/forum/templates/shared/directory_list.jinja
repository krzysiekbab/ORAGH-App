{% comment %}
Reusable template for displaying a list of directories
Parameters:
- directories: List of directory data objects (with directory, posts_count, comments_count, last_post) OR direct directory objects
- show_comments_count: Boolean to show comments count (default: true)
- empty_message: Custom message when no directories (optional)
- empty_action_url: URL for action button when empty (optional)
- empty_action_text: Text for action button when empty (optional)
{% endcomment %}

{% if directories %}
  <div class="row g-3">
    {% for item in directories %}
      <div class="col-12">
        {% comment %}Handle both directory data objects and direct directory objects{% endcomment %}
        {% if item.directory %}
          {% comment %}This is a directory data object from forum_index{% endcomment %}
          <div class="card border-0 shadow-sm directory-card {{ item.directory.get_highlight_classes|default:'' }}">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-2 directory-title">
                    <span class="directory-icon">{{ item.directory.get_highlight_icon|default:'' }}</span>
                    <a href="{{ item.directory.get_absolute_url }}" class="text-decoration-none directory-link">
                      {{ item.directory.name }}
                    </a>
                    {% if item.directory.access_level == 'board' %}
                      <span class="badge bg-danger ms-2">Tylko zarzd</span>
                    {% endif %}
                  </h6>
                  {% if item.directory.description %}
                    <p class="text-muted mb-2 small">{{ item.directory.description }}</p>
                  {% endif %}
                  <div class="d-flex gap-3">
                    <small class="text-muted">
                      <i class="fas fa-file-alt"></i> {{ item.posts_count }} post贸w
                    </small>
                    {% if show_comments_count|default:true %}
                      <small class="text-muted">
                        <i class="fas fa-comment"></i> {{ item.comments_count }} komentarzy
                      </small>
                    {% else %}
                      <small class="text-muted">
                        <i class="fas fa-folder"></i> {{ item.directory.subdirectories.count }} podkatalog贸w
                      </small>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-4 text-md-end">
                  {% if item.last_post %}
                    <div class="text-muted small">
                      <strong>Ostatni post:</strong><br>
                      <a href="{{ item.last_post.get_absolute_url }}" class="text-decoration-none">
                        {{ item.last_post.title|truncatechars:30 }}
                      </a><br>
                      <small>{{ item.last_post.updated_at|date:"d.m.Y H:i" }}</small>
                    </div>
                  {% else %}
                    <div class="text-muted small">
                      <em>Brak post贸w</em>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% else %}
          {% comment %}This is a direct directory object from directory_view{% endcomment %}
          <div class="card border-0 shadow-sm directory-card {{ item.get_highlight_classes|default:'' }}">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-2 directory-title">
                    <span class="directory-icon">{{ item.get_highlight_icon|default:'' }}</span>
                    <a href="{{ item.get_absolute_url }}" class="text-decoration-none directory-link">
                      {{ item.name }}
                    </a>
                    {% if item.access_level == 'board' %}
                      <span class="badge bg-danger ms-2">Tylko zarzd</span>
                    {% endif %}
                  </h6>
                  {% if item.description %}
                    <p class="text-muted mb-2 small">{{ item.description }}</p>
                  {% endif %}
                  <div class="d-flex gap-3">
                    <small class="text-muted">
                      <i class="fas fa-file-alt"></i> {{ item.posts.count }} post贸w
                    </small>
                    {% if show_comments_count|default:true %}
                      <small class="text-muted">
                        <i class="fas fa-comment"></i> 0 komentarzy
                      </small>
                    {% else %}
                      <small class="text-muted">
                        <i class="fas fa-folder"></i> {{ item.subdirectories.count }} podkatalog贸w
                      </small>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-4 text-md-end">
                  {% with last_post=item.posts.first %}
                    {% if last_post %}
                      <div class="text-muted small">
                        <strong>Ostatni post:</strong><br>
                        <a href="{{ last_post.get_absolute_url }}" class="text-decoration-none">
                          {{ last_post.title|truncatechars:30 }}
                        </a><br>
                        <small>{{ last_post.updated_at|date:"d.m.Y H:i" }}</small>
                      </div>
                    {% else %}
                      <div class="text-muted small">
                        <em>Brak post贸w</em>
                      </div>
                    {% endif %}
                  {% endwith %}
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center py-5">
    <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
    <p class="text-muted mb-0">{{ empty_message|default:"Brak dostpnych katalog贸w." }}</p>
    {% if empty_action_url and empty_action_text %}
      <a href="{% url empty_action_url %}" class="btn btn-primary mt-2">
        <i class="fas fa-plus"></i> {{ empty_action_text }}
      </a>
    {% endif %}
  </div>
{% endif %}
